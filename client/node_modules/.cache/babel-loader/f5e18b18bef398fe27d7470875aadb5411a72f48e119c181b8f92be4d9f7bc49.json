{"ast":null,"code":"// client/src/services/tournamentService.js\n\nimport apiService from './api';\nconst BASE_URL = '/api/tournaments';\n\n// Client-side cache for tournament data\nconst cache = {\n  data: {},\n  timestamp: {},\n  TTL: 30000,\n  // 30 second TTL for cache entries\n\n  // Check if a cached item is still valid\n  isValid(key) {\n    return this.data[key] && this.timestamp[key] && Date.now() - this.timestamp[key] < this.TTL;\n  },\n  // Get item from cache\n  get(key) {\n    if (this.isValid(key)) {\n      console.log(`Using cached data for ${key}`);\n      return this.data[key];\n    }\n    return null;\n  },\n  // Set item in cache\n  set(key, data) {\n    console.log(`Caching data for ${key}`);\n    this.data[key] = data;\n    this.timestamp[key] = Date.now();\n  },\n  // Clear a specific item from cache\n  clear(key) {\n    delete this.data[key];\n    delete this.timestamp[key];\n  },\n  // Clear all cache\n  clearAll() {\n    this.data = {};\n    this.timestamp = {};\n  }\n};\nclass TournamentService {\n  // Get all tournaments\n  async getAllTournaments() {\n    return apiService.get(BASE_URL);\n  }\n\n  // Get tournament by ID (with caching)\n  async getTournamentById(tournamentId) {\n    const cacheKey = `tournament_${tournamentId}`;\n\n    // Try to get from cache first\n    const cachedData = cache.get(cacheKey);\n    if (cachedData) {\n      return cachedData;\n    }\n\n    // If not in cache, make API request\n    try {\n      console.log(`Fetching tournament ${tournamentId} from API`);\n\n      // Make direct fetch request to bypass potential issues with the API service\n      const response = await fetch(`/api/tournaments/${tournamentId}`, {\n        headers: {\n          'Cache-Control': 'max-age=30',\n          'Accept': 'application/json'\n        }\n      });\n\n      // First check if the response is OK\n      if (!response.ok) {\n        const errorData = await response.json();\n        throw new Error(errorData.error || `Server returned ${response.status}`);\n      }\n\n      // Parse the response JSON\n      const data = await response.json();\n\n      // Log the exact response format for debugging\n      console.log('Raw tournament response:', JSON.stringify(data));\n\n      // Make sure we have valid data before caching\n      if (data && data.data) {\n        const processedResponse = {\n          data: data\n        };\n        console.log('Successfully processed tournament data');\n        // Store in cache\n        cache.set(cacheKey, processedResponse);\n        return processedResponse;\n      } else {\n        console.warn('Missing or invalid tournament data in response:', data);\n        throw new Error('Invalid response format from server');\n      }\n    } catch (error) {\n      // Handle rate limit specifically\n      if (error.response && error.response.status === 429) {\n        console.warn('Rate limit hit when fetching tournament. Using stale cache if available.');\n        // If we hit rate limits, try to use stale data if we have it\n        if (cache.data[cacheKey]) {\n          console.log('Using stale cache data due to rate limit');\n          return cache.data[cacheKey];\n        }\n      }\n      console.error('Error fetching tournament:', error);\n      throw error;\n    }\n  }\n\n  // Create new tournament\n  async createTournament(tournamentData) {\n    console.log('Creating tournament with data:', tournamentData);\n\n    // Ensure all dates are properly formatted\n    const formattedData = {\n      ...tournamentData,\n      startDate: tournamentData.startDate instanceof Date ? tournamentData.startDate.toISOString() : tournamentData.startDate,\n      endDate: tournamentData.endDate instanceof Date ? tournamentData.endDate.toISOString() : tournamentData.endDate\n    };\n    console.log('Formatted data:', formattedData);\n    return apiService.post(BASE_URL, formattedData);\n  }\n\n  // Update tournament\n  async updateTournament(tournamentId, tournamentData) {\n    return apiService.put(`${BASE_URL}/${tournamentId}`, tournamentData);\n  }\n\n  // Delete tournament\n  async deleteTournament(tournamentId) {\n    return apiService.delete(`${BASE_URL}/${tournamentId}`);\n  }\n\n  // Get tournament teams\n  async getTournamentTeams(tournamentId) {\n    return apiService.get(`${BASE_URL}/${tournamentId}/teams`);\n  }\n\n  // Add team to tournament\n  async addTeamToTournament(tournamentId, teamId) {\n    return apiService.post(`${BASE_URL}/${tournamentId}/teams`, {\n      teamId\n    });\n  }\n\n  // Remove team from tournament\n  async removeTeamFromTournament(tournamentId, teamId) {\n    return apiService.delete(`${BASE_URL}/${tournamentId}/teams/${teamId}`);\n  }\n\n  // Get tournament matches\n  async getTournamentMatches(tournamentId) {\n    return apiService.get(`${BASE_URL}/${tournamentId}/matches`);\n  }\n\n  // Add match to tournament\n  async addMatchToTournament(tournamentId, matchData) {\n    return apiService.post(`${BASE_URL}/${tournamentId}/matches`, matchData);\n  }\n\n  // Get tournament leaderboard\n  async getTournamentLeaderboard(tournamentId) {\n    return apiService.get(`${BASE_URL}/${tournamentId}/leaderboard`);\n  }\n\n  // Join tournament (adding this missing function)\n  async joinTournament(tournamentId, teamId) {\n    console.log('Joining tournament:', tournamentId, 'with team:', teamId);\n    return this.addTeamToTournament(tournamentId, teamId);\n  }\n\n  // Clear specific cache entry\n  clearCache(key) {\n    try {\n      console.log(`Clearing cache for ${key}`);\n      cache.clear(key);\n    } catch (e) {\n      console.warn('Error clearing cache:', e);\n    }\n  }\n\n  // Clear all cache\n  clearAllCache() {\n    console.log('Clearing all tournament cache');\n    cache.clearAll();\n  }\n}\nexport default new TournamentService();","map":{"version":3,"names":["apiService","BASE_URL","cache","data","timestamp","TTL","isValid","key","Date","now","get","console","log","set","clear","clearAll","TournamentService","getAllTournaments","getTournamentById","tournamentId","cacheKey","cachedData","response","fetch","headers","ok","errorData","json","Error","error","status","JSON","stringify","processedResponse","warn","createTournament","tournamentData","formattedData","startDate","toISOString","endDate","post","updateTournament","put","deleteTournament","delete","getTournamentTeams","addTeamToTournament","teamId","removeTeamFromTournament","getTournamentMatches","addMatchToTournament","matchData","getTournamentLeaderboard","joinTournament","clearCache","e","clearAllCache"],"sources":["C:/Users/emil/OneDrive/Documents/development/apiDevelopment/pubg-tournament-tracker/client/src/services/tournamentService.js"],"sourcesContent":["// client/src/services/tournamentService.js\n\nimport apiService from './api';\n\nconst BASE_URL = '/api/tournaments';\n\n// Client-side cache for tournament data\nconst cache = {\n  data: {},\n  timestamp: {},\n  TTL: 30000, // 30 second TTL for cache entries\n  \n  // Check if a cached item is still valid\n  isValid(key) {\n    return (\n      this.data[key] && \n      this.timestamp[key] && \n      Date.now() - this.timestamp[key] < this.TTL\n    );\n  },\n  \n  // Get item from cache\n  get(key) {\n    if (this.isValid(key)) {\n      console.log(`Using cached data for ${key}`);\n      return this.data[key];\n    }\n    return null;\n  },\n  \n  // Set item in cache\n  set(key, data) {\n    console.log(`Caching data for ${key}`);\n    this.data[key] = data;\n    this.timestamp[key] = Date.now();\n  },\n  \n  // Clear a specific item from cache\n  clear(key) {\n    delete this.data[key];\n    delete this.timestamp[key];\n  },\n  \n  // Clear all cache\n  clearAll() {\n    this.data = {};\n    this.timestamp = {};\n  }\n};\n\nclass TournamentService {\n  // Get all tournaments\n  async getAllTournaments() {\n    return apiService.get(BASE_URL);\n  }\n  \n  // Get tournament by ID (with caching)\n  async getTournamentById(tournamentId) {\n    const cacheKey = `tournament_${tournamentId}`;\n    \n    // Try to get from cache first\n    const cachedData = cache.get(cacheKey);\n    if (cachedData) {\n      return cachedData;\n    }\n    \n    // If not in cache, make API request\n    try {\n      console.log(`Fetching tournament ${tournamentId} from API`);\n      \n      // Make direct fetch request to bypass potential issues with the API service\n      const response = await fetch(`/api/tournaments/${tournamentId}`, {\n        headers: {\n          'Cache-Control': 'max-age=30',\n          'Accept': 'application/json'\n        }\n      });\n      \n      // First check if the response is OK\n      if (!response.ok) {\n        const errorData = await response.json();\n        throw new Error(errorData.error || `Server returned ${response.status}`);\n      }\n      \n      // Parse the response JSON\n      const data = await response.json();\n      \n      // Log the exact response format for debugging\n      console.log('Raw tournament response:', JSON.stringify(data));\n      \n      // Make sure we have valid data before caching\n      if (data && data.data) {\n        const processedResponse = {\n          data: data\n        };\n        console.log('Successfully processed tournament data');\n        // Store in cache\n        cache.set(cacheKey, processedResponse);\n        return processedResponse;\n      } else {\n        console.warn('Missing or invalid tournament data in response:', data);\n        throw new Error('Invalid response format from server');\n      }\n    } catch (error) {\n      // Handle rate limit specifically\n      if (error.response && error.response.status === 429) {\n        console.warn('Rate limit hit when fetching tournament. Using stale cache if available.');\n        // If we hit rate limits, try to use stale data if we have it\n        if (cache.data[cacheKey]) {\n          console.log('Using stale cache data due to rate limit');\n          return cache.data[cacheKey];\n        }\n      }\n      \n      console.error('Error fetching tournament:', error);\n      throw error;\n    }\n  }\n  \n  // Create new tournament\n  async createTournament(tournamentData) {\n    console.log('Creating tournament with data:', tournamentData);\n    \n    // Ensure all dates are properly formatted\n    const formattedData = {\n      ...tournamentData,\n      startDate: tournamentData.startDate instanceof Date \n        ? tournamentData.startDate.toISOString() \n        : tournamentData.startDate,\n      endDate: tournamentData.endDate instanceof Date \n        ? tournamentData.endDate.toISOString() \n        : tournamentData.endDate\n    };\n    \n    console.log('Formatted data:', formattedData);\n    return apiService.post(BASE_URL, formattedData);\n  }\n  \n  // Update tournament\n  async updateTournament(tournamentId, tournamentData) {\n    return apiService.put(`${BASE_URL}/${tournamentId}`, tournamentData);\n  }\n  \n  // Delete tournament\n  async deleteTournament(tournamentId) {\n    return apiService.delete(`${BASE_URL}/${tournamentId}`);\n  }\n  \n  // Get tournament teams\n  async getTournamentTeams(tournamentId) {\n    return apiService.get(`${BASE_URL}/${tournamentId}/teams`);\n  }\n  \n  // Add team to tournament\n  async addTeamToTournament(tournamentId, teamId) {\n    return apiService.post(`${BASE_URL}/${tournamentId}/teams`, { teamId });\n  }\n  \n  // Remove team from tournament\n  async removeTeamFromTournament(tournamentId, teamId) {\n    return apiService.delete(`${BASE_URL}/${tournamentId}/teams/${teamId}`);\n  }\n  \n  // Get tournament matches\n  async getTournamentMatches(tournamentId) {\n    return apiService.get(`${BASE_URL}/${tournamentId}/matches`);\n  }\n  \n  // Add match to tournament\n  async addMatchToTournament(tournamentId, matchData) {\n    return apiService.post(`${BASE_URL}/${tournamentId}/matches`, matchData);\n  }\n  \n  // Get tournament leaderboard\n  async getTournamentLeaderboard(tournamentId) {\n    return apiService.get(`${BASE_URL}/${tournamentId}/leaderboard`);\n  }\n  \n  // Join tournament (adding this missing function)\n  async joinTournament(tournamentId, teamId) {\n    console.log('Joining tournament:', tournamentId, 'with team:', teamId);\n    return this.addTeamToTournament(tournamentId, teamId);\n  }\n  \n  // Clear specific cache entry\n  clearCache(key) {\n    try {\n      console.log(`Clearing cache for ${key}`);\n      cache.clear(key);\n    } catch (e) {\n      console.warn('Error clearing cache:', e);\n    }\n  }\n  \n  // Clear all cache\n  clearAllCache() {\n    console.log('Clearing all tournament cache');\n    cache.clearAll();\n  }\n}\n\nexport default new TournamentService();"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}